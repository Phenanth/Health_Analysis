# README

## Git使用

`git log`
`git reset [id]`回退，遇到不想要的本地cache时，最好回退到`origin/master`

## List数据入库

> 已完成

数据项比较统一，好操作。

## Abnormal数据入库

> 已完成

因为数据项比较统一，这个过程应该也会比较快

但是有个疑问，诊断内容（match_name）五花八门，需要做整理吗？

还有个现象，有些数据的Id是`'7a9fbdd153b84fd39fdf9b7e082616bc'`这种类似于reportId长度的数据(只有三条)，和其他的六位编号`'C30080', `形式不同。

## Template数据入库

> 已完成

数据项比较统一，处理起来应该不难
把缺少的`minValue`和`maxValue`的数值也给添加上去了

## Report数据入库
重头戏，数据项很不统一
需要将不同的名称映射到一个标准名上
其次再按照一个标准的数据结构将每个JSON导入到相应表中

### 数据库表设计

#### Index表设计

统计了一下所有文件的key，发现同样的数值有很多不同的名称，需要建立index表来对不同数值统一命名。

key一览（以常规检查为例）：
```bash
['脉搏', '体重', '身高', '复测血压(收缩压)', '体重指数', '复测血压(舒张压)', '体检血压(收缩压)', '体检血压(舒张压)', 'reportId', 'clientId', '舒张压', '收缩压', '复测血压2(舒张压)', '复测血压2(收缩压)', '腰围(男)', '臀围', '臀围(男)', '腰臀比'...]
```

重复内容（简略）：
搜简写能够找到很多重复的值
```bash
['血小板容积分布宽度（PDW）',
 '血小板比容（PCT）', # 这个
 '血小板(PLT)', # 这个
 '血红蛋白(Hb)',
 '血小板容积分布宽度[PDW]',
 '血小板计数(PLT)', # 这个
 '红细胞压积[HCT]',
 '血小板压积[PCT]', # 这个
 '中性粒细胞百分比[N]',
 '中性粒细胞绝对值（GRA#）'],
 ...
```

Index的设计过程又写了个脚本文件，因为想着手工比对既存分类实在是太泯灭人性了...
参考`/Health_Analysis/scripts/programm_mannual_classifier.py`

效果预览`index_tumour.json`:
```JSON
{
    "indexs": [
        "癌胚抗原CEA(发光)",
        "甲胎蛋白AFP(发光)",
        "糖类抗原125(CA125)(发光)",
        "游离前列腺特异性抗原（F-PSA）",
        "糖类抗原19-9(CA19-9)",
        "总前列腺特异性抗原（T-PSA）",
        "F-PSA/T-PSA",
        "糖类抗原15-3(CA15-3)",
        "细胞角蛋白19片段(Cyfra 21-1)",
        "鳞状细胞相关抗原(SCC)",
        "糖类抗原242",
        "糖类抗原72-4(CA72-4)",
        "铁蛋白(FER)",
        "胃泌素-17",
        "胃蛋白酶原I/胃蛋白酶原II测定",
        "胃蛋白酶原I[PGI]",
        "胃蛋白酶原II[PGII]",
        ...
    ],
    "mapping": [
        {
            "reportName": "癌胚抗原CEA(发光)",
            "scientificName": "癌胚抗原CEA(发光)"
        },
        {
            "reportName": "甲胎蛋白AFP(发光)",
            "scientificName": "甲胎蛋白AFP(发光)"
        },
        {
            "reportName": "糖类抗原125(CA125)(发光)",
            "scientificName": "糖类抗原125(CA125)(发光)"
        },
        ...
    ]
}
```

关于胰岛素抗体那里真的把我这个人工分类的人搞蒙了，跑去查了资料：
胰岛素抗体INS-Ab可以分成
- 抗胰岛素细胞抗体ICA/IA
- 抗胰岛素自身抗体IAA

个人分类完成之后总共有178个不同的列
> 还不知道分类在医学上是否准确...
> 我和谷歌已经尽力了
> 想把scientificName统一改成小括号，然后GG了，全部都改掉了（不要手滑

还需要做统一英文命名，这个就还是人工做吧（

设计完了index，相当于已经把表列简化工作做完了，就需要实打实地设计表列了
应该可以通过脚本便捷化处理，通过表修改的方式将不重复的列名添加进去。
*注意：index表内处于一个genre下的数据是属于同一个表的*

SQL区别
- 汉字
- 为空
- 尾部s/°等特殊符号
- 数字

### Report_[genre]表的设计

> 未开始

### 入库

初步构想的入库的流程：
1. 查询该json对应的表，新建该对应表的标准数据结构
2. 在index表中查询当前json所有数据项对应的标准名
3. 在当前数据结构中添加对应标准名的数据项
4. 对于不存在的数据列，在数据结构中将其赋值为空

#### 数据库表修正语句

修改字段长度：
`alter table report_thyroid modify column THY_Detail varchar(400);`

修改表编码：
`alter table report_blood character set utf8;`

修改列编码：
`alter table report_heart modify column ECG varchar(10) character set utf8mb4 collate utf8mb4_unicode_ci;`

#### report_heart

由于该数据原本就并不标准，舍弃：
```bash
Data too long: ('c1278fe404334da1b53fc1bb37dea474', 'ac8d34b395b54720a04cd50b84718345', '0', '0', '0', '0', '0', '0', ' 窦性心律\n***正常心电图***', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0')
```

### 数据汇总

在对每个表入库后，需要将同一个病人的报告信息汇总到一张总表上
总表将概括不仅包括所有report数据项的内容，还应该包括一个abnormal字段。
> abnormal为6字符长度的字符串，每一位表示一个检查分类下的异常项数
